<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Firebase Test</title>
  <script type="module">
  import { app, auth, db, analytics } from './firebase-init.js';
  import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js';
  import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js';

    const out = (msg) => {
      const el = document.getElementById('out');
      el.innerText += msg + '\n';
    }

    try {
      out('Firebase initialized (centralized)');
      out('Auth & Firestore clients created (centralized)');

      // Try a lightweight Firestore read: look for a doc that probably doesn't exist — expecting either success or permission error
      (async () => {
        try {
          const testRef = doc(db, '__test_conn__', 'ping');
          const snap = await getDoc(testRef);
          out('Firestore read attempted — ok (permissions may block read but SDK loaded)');
        } catch (e) {
          out('Firestore read failed: ' + e.message);
        }
      })();

      // Check auth readiness
      onAuthStateChanged(auth, user => {
        out('Auth state changed — user: ' + (user ? user.email || user.uid : 'not signed in'));
      });
    } catch (err) {
      out('Initialization error: ' + err.message);
    }
  </script>
  <style>body{font-family:Inter,system-ui,sans-serif;padding:20px;background:#fff;color:#111}</style>
</head>
<body>
  <h1>Firebase connectivity test</h1>
  <pre id="out" style="white-space:pre-wrap;background:#f7f7f7;padding:12px;border-radius:8px;min-height:120px"></pre>
  <p>Note: if you see API key errors, check the `firebase-config.js` values and API key restrictions in Google Cloud Console.</p>
</body>
</html>
